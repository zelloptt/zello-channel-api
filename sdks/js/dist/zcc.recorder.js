!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ZCC=t():(e.ZCC=e.ZCC||{},e.ZCC.Recorder=t())}(self,(()=>(()=>{var e={868:(e,t,i)=>{function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var n=Object.freeze({Inactive:"inactive",Recording:"recording",Paused:"paused"}),s=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!e.isRecordingSupported())throw new Error("Recording is not supported in this browser");this.options=Object.assign({bufferLength:0,monitorGain:0,recordingGain:1,mediaConstraints:{audio:!0}},t),this.encoder=i,this.state=n.Inactive}var t,s,r;return t=e,s=[{key:"clearStream",value:function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((function(e){e.stop()})):this.stream.stop(),delete this.stream),this.audioContext&&(this.audioContext.close(),delete this.audioContext)}},{key:"disconnectNodes",value:function(){this.sourceNode.disconnect(),this.recordingGainNode.disconnect(),this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect()}},{key:"getSampleRate",value:function(){return this.audioContext.sampleRate}},{key:"encodeBuffers",value:function(e){if(this.state===n.Recording){for(var t=[],i=0;i<e.numberOfChannels;i++)t[i]=e.getChannelData(i);this.ondata(t)}}},{key:"initAudioContext",value:function(){if(!this.audioContext){var t=e.getAudioContext();this.audioContext=new t}return this.audioContext}},{key:"initAudioGraph",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||(this.encodeBuffers=function(){delete e.encodeBuffers}),this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.options.bufferLength,this.options.numberOfChannels,this.options.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer),void 0!==e.bufferLimit&&++e.buffersEncoded>=e.bufferLimit&&(e.clearStopTimeout(),e.stop())},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.options.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.options.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)}},{key:"initSourceNode",value:function(){var e=this;return this.stream&&this.sourceNode?i.g.Promise.resolve(this.sourceNode):i.g.navigator.mediaDevices.getUserMedia(this.options.mediaConstraints).then((function(t){return e.stream=t,e.audioContext.createMediaStreamSource(t)}))}},{key:"pause",value:function(){this.state===n.Recording&&(this.state=n.Paused)}},{key:"resume",value:function(){this.state===n.Paused&&(this.state=n.Recording)}},{key:"setRecordingGain",value:function(e){this.options.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}},{key:"setMonitorGain",value:function(e){this.options.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}},{key:"changeInputDevice",value:function(e){var t=this;this.state===n.Recording&&(this.options.mediaConstraints.audio={deviceId:{exact:e}},this.disconnectNodes(),this.clearStream(),this.initAudioContext(),this.initAudioGraph(!0),this.initSourceNode().then((function(e){t.sourceNode=e,t.sourceNode.connect(t.monitorGainNode),t.sourceNode.connect(t.recordingGainNode)})))}},{key:"init",value:function(){var e=this;return this.state!==n.Inactive?i.g.Promise.reject("Recording is not inactive"):(this.initAudioContext(),this.initAudioGraph(),this.initSourceNode().then((function(t){e.state=n.Recording,e.sourceNode=t,e.sourceNode.connect(e.monitorGainNode),e.sourceNode.connect(e.recordingGainNode),e.onready()})))}},{key:"stop",value:function(){this.state!==n.Inactive&&(this.state=n.Inactive,this.disconnectNodes(),this.options.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"done"}))}},{key:"stopAfter",value:function(e){var t=this;this.clearStopTimeout(),this.stopTimeout=setTimeout((function(){t.stop()}),1e3),this.setBufferLimit(e)}},{key:"setBufferLimit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.bufferLimit=e,this.buffersEncoded=0}},{key:"clearStopTimeout",value:function(){this.stopTimeout&&(clearTimeout(this.stopTimeout),this.stopTimeout=void 0)}},{key:"start",value:function(){}},{key:"ondata",value:function(e){}},{key:"onready",value:function(){}}],r=[{key:"getAudioContext",value:function(){return i.g.AudioContext||i.g.webkitAudioContext}},{key:"isRecordingSupported",value:function(){return e.getAudioContext()&&i.g.navigator&&i.g.navigator.mediaDevices&&i.g.navigator.mediaDevices.getUserMedia&&i.g.WebAssembly}}],s&&o(t.prototype,s),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();e.exports=s}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,i),s.exports}return i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i(868)})()));